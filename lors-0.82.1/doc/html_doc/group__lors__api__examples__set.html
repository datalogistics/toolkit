<html>
<head>
<title>LoCI</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel=stylesheet type="text/css" href="style_dox.css">
</head> 

<body>

<div align="left"><table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr><td width="150" rowspan="6" align="right" valign="top">


<!--The left blocks - logo box and menu box:-->

<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td align="right">
<div><a href="http://loci.cs.utk.edu"><img src="http://loci.cs.utk.edu/themes/Alison/images/logo_01.gif" width=144 height=152 border=0></a></div><br></td></tr>
</table>


<!--
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td class="menubox" align="right">
&nbsp;<a href="/redirect?/">Home</a><br>
<a href="/redirect?modules.php?name=Content"><b>| Projects |</b></a><br>

<a href="/redirect?modules.php?name=People">People</a><br>

<a href="/redirect?modules.php?name=Related_Projects">Related Projects</a><br>

<a href="/redirect?modules.php?name=Downloads">Downloads</a><br>

<a href="/redirect?modules.php?name=Stories_Archive">News Archive</a><br>

<a href="/redirect?modules.php?name=Feedback">Feedback</a><br>

<br></td><td width="23"><img src="/loadimage?images/pixel.gif" width="23" height="1"></td></tr>
</table>
-->
<!--End of left blocks.-->


</td><td height="26" width="10"><img src="http://loci.cs.utk.edu/themes/Alison/images/topleft_corner.gif" width="10" height="26"></td>
<td class="titlecell" height="26" align="center" colspan="2"><img src="http://loci.cs.utk.edu/themes/Alison/images/LoCI_Title.gif" width="500" height="26"></td>
<td width="10" height="26"><img src="http://loci.cs.utk.edu/themes/Alison/images/topright_corner.gif" width="10" height="26"></td>
</tr>
<tr><td colspan="4" class="projecttitlecell"><img src="http://loci.cs.utk.edu/themes/Alison/images/proj_header_LoRS.gif" width="392" height="58"></td></tr>
<tr><td class="projectmenucell" colspan="4">


<!--This is where the horizontal menu items under the project header go. Don't put any spacing or font style into the series of links; this is taken care of by the style sheet in class "projectmenucell".-->

<!--
<a href="/redirect?http://www.google.com/">Main Page</a><a href="/redirect?http://www.google.com/">Modules</a><a href="/redirect?http://www.google.com/">Data Structure</a><a href="/redirect?http://www.google.com/">File List</a>
<a href="/redirect?http://www.google.com/">Data Fields</a><a href="/redirect?http://www.google.com/">Globals</a><a href="/redirect?http://www.google.com/">

-->
</td></tr>
<tr>

<td class="cellcontent" rowspan="2" width="10"><img src="/loadimage?/themes/Alison/images/dot.gif" width="10" height="1"></td>
<td  valign="center">


<!--The main column of information goes here:-->

<table width="100%" border="0" cellspacing="0" cellpadding="0" bgcolor="#FFFFFF"><tr><td>
<tr>
<td>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>
<hr><h1>The LoRS Set API Examples.<br>
<small>
[<a class="el" href="group__lors__api__set.html">The LoRS API for Sets</a>]</small>
</h1><table border=0 cellpadding=0 cellspacing=0>
</table>
Welcome to the Logistical Runtime System (LoRS) API example page.
<p>
<dl compact><dt><b>
Note: </b><dd>
This program will create an exnode and serialize it to disk. The input and output filename is passed from the command line.<br>
<br>
<br>
 <div class="fragment"><pre>    <font class="keywordtype">int</font> main (<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font> **argv)
    {
        <a class="code" href="struct____LorsSet.html">LorsSet</a>             *se;
        <a class="code" href="struct____LorsDepotPool.html">LorsDepotPool</a>       *dp;
        <a class="code" href="struct____LorsExnode.html">LorsExnode</a>          *ex;
        <font class="keywordtype">int</font>                  ret;
        <font class="keywordtype">char</font>                *buffer;
        <font class="keywordtype">int</font>                 fd;
        <a class="code" href="lors__api_8h.html#a3">longlong</a>            size;
        <font class="keyword">struct </font>stat         mstat;

        ret = stat(argv[1], &amp;mstat);
        <font class="keywordflow">if</font> ( ret == -1 ) { perror(<font class="stringliteral">"error1"</font>); exit(EXIT_FAILURE); }
        fd = open(argv[1], O_RDONLY);
        <font class="keywordflow">if</font> ( fd == -1 ) { perror(<font class="stringliteral">"error2"</font>); exit(EXIT_FAILURE);  }

        size = mstat.st_size;
        buffer = malloc(<font class="keyword">sizeof</font>(<font class="keywordtype">char</font>)*size);
        <font class="keywordflow">if</font> ( buffer == NULL ) { perror(<font class="stringliteral">"error3"</font>); exit(EXIT_FAILURE); }

        ret = <a class="code" href="lors__api_8h.html#a0">lorsGetDepotPool</a>(&amp;dp, <font class="stringliteral">"galapagos.cs.utk.edu"</font>, 6767, NULL,
                               6, 
                               <font class="stringliteral">"st= ca"</font>, 
                               (ulong_t)(size/(1024*1024)+1), 
                               <a class="code" href="lors__api_8h.html#a2">IBP_SOFT</a>, 
                               60*60, 10, 20, <a class="code" href="lors__opts_8h.html#a1">LORS_CHECKDEPOTS</a>);
        <font class="keywordflow">if</font> ( ret != <a class="code" href="lors__error_8h.html#a0">LORS_SUCCESS</a> ) {  perror(<font class="stringliteral">"error4"</font>); exit(EXIT_FAILURE);  }

        ret = <a class="code" href="lors__api_8h.html#a5">lorsSetInit</a>(&amp;se, size/3, 2, 0);
        <font class="keywordflow">if</font> ( ret != <a class="code" href="lors__error_8h.html#a0">LORS_SUCCESS</a> ) {  perror(<font class="stringliteral">"error5"</font>); exit(EXIT_FAILURE);  }

        ret = read(fd, buffer, size);
        <font class="keywordflow">if</font> ( ret != size) {  perror(<font class="stringliteral">"error6"</font>); exit(EXIT_FAILURE);  }

        ret = <a class="code" href="lors__api_8h.html#a6">lorsSetStore</a>(se, dp, buffer, se-&gt;<a class="code" href="struct____LorsSet.html#m5">max_length</a>, size, NULL, 6, 20, 0);
        <font class="keywordflow">if</font> ( ret != <a class="code" href="lors__error_8h.html#a0">LORS_SUCCESS</a> ) {  perror(<font class="stringliteral">"error7"</font>); exit(EXIT_FAILURE);  }

        ret = <a class="code" href="lors__api_8h.html#a2">lorsExnodeCreate</a>(&amp;ex);
        <font class="keywordflow">if</font> ( ret != <a class="code" href="lors__error_8h.html#a0">LORS_SUCCESS</a> ) {  perror(<font class="stringliteral">"error8"</font>); exit(EXIT_FAILURE);  }

        ret = <a class="code" href="lors__api_8h.html#a3">lorsAppendSet</a>(ex, se);
        <font class="keywordflow">if</font> ( ret != <a class="code" href="lors__error_8h.html#a0">LORS_SUCCESS</a> ) {  perror(<font class="stringliteral">"error9"</font>); exit(EXIT_FAILURE);  }

        ret = <a class="code" href="lors__api_8h.html#a9">lorsFileSerialize</a>(ex, argv[2], 0, 0);
        <font class="keywordflow">if</font> ( ret != <a class="code" href="lors__error_8h.html#a0">LORS_SUCCESS</a> ) {  perror(<font class="stringliteral">"error10"</font>); exit(EXIT_FAILURE);  }

        <font class="keywordflow">return</font> 0;
    }
</pre></div></dl><dl compact><dt><b>
Note: </b><dd>
This program will deserialize an exnode download it and write the data to disk. The input and output filename is passed from the command line. <br>
<br>
<br>
 <div class="fragment"><pre>    <font class="keywordtype">int</font> main (<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font> **argv)
    {

        <a class="code" href="struct____LorsSet.html">LorsSet</a>       *se;
        <a class="code" href="struct____LorsSet.html">LorsSet</a>       *sel, *sel2;
        <a class="code" href="struct____LorsDepotPool.html">LorsDepotPool</a>       *dp;
        <a class="code" href="struct____LorsExnode.html">LorsExnode</a>          *ex;
        <font class="keywordtype">int</font>                  ret;
        <font class="keywordtype">int</font>                 written = 0;
        <font class="keywordtype">char</font>                *buffer;
        <font class="keywordtype">int</font>                 fd;
        <a class="code" href="lors__api_8h.html#a3">longlong</a>            size;
        <font class="keyword">struct </font>stat         mstat;

        ret = <a class="code" href="lors__api_8h.html#a7">lorsFileDeserialize</a>(&amp;ex, argv[1], NULL);
        <font class="keywordflow">if</font> ( ret != <a class="code" href="lors__error_8h.html#a0">LORS_SUCCESS</a> ) { exit(EXIT_FAILURE); }
        fd = open(argv[2], O_WRONLY|O_CREAT|O_TRUNC, 0644);
        <font class="keywordflow">if</font> ( fd == -1 ) { perror(<font class="stringliteral">"error1"</font>); exit(EXIT_FAILURE);  }

        size = ex-&gt;<a class="code" href="struct____LorsExnode.html#m5">logical_length</a>;
        buffer = malloc(<font class="keyword">sizeof</font>(<font class="keywordtype">char</font>)*size);
        <font class="keywordflow">if</font> ( buffer == NULL ) { perror(<font class="stringliteral">"error2"</font>); exit(EXIT_FAILURE); }

        ret = <a class="code" href="lors__api_8h.html#a1">lorsUpdateDepotPool</a>(ex, &amp;dp, NULL, 0, NULL, 1, 60, 0);

        ret = <a class="code" href="lors__api_8h.html#a10">lorsQuery</a>(ex, &amp;se, 0, ex-&gt;<a class="code" href="struct____LorsExnode.html#m5">logical_length</a>, 0);
        written = 0;
        <font class="keywordflow">while</font> ( written &lt; size )
        {

            fprintf(stderr, <font class="stringliteral">"offset: %d len: %ld\n"</font>,
                            written, (<font class="keywordtype">long</font>)(size-written));
            ret = <a class="code" href="lors__api_8h.html#a7">lorsSetLoad</a>(se, buffer, 
                              (<a class="code" href="lors__api_8h.html#a3">longlong</a>)written, (<font class="keywordtype">long</font>)(size-written), 
                              512*1024,
                              NULL, 10, 
                              100, 0);

            fprintf(stderr, <font class="stringliteral">"returned: %d\n"</font>, ret);
            <font class="keywordflow">if</font> ( ret != (size-written) ) { printf(<font class="stringliteral">"less than requested\n"</font>); exit(EXIT_FAILURE); }
            written += ret;
            ret = write(fd, buffer, ret);

        }
        close(fd);
    }
</pre></div> </dl></td>
</tr>
</table>

</td>

<td class="cellcontent" rowspan="2" colspan="2" width="10"><img src="http://loci.cs.utk.edu/themes/Alison/images/dot.gif" width="10" height="1"></td></tr><tr>
<td class="cellcontent" valign="top" colspan="2">
<!--<center><table>
<p><a href="/redirect?http://www.utk.edu" title="UTK home"><img src="http://loci.cs.utk.edu/lbone/images/utk.gif" width="130" height="75" alt="UTK home" title="UTK home" border=0></a>
&nbsp;&nbsp;<a href="/redirect?http://www.energy.gov" title="DOE"><img src="http://loci.cs.utk.edu/lbone/images/doe.gif" width="140" height="75" alt="DOE" title="DOE" border=0></a>
<a href="/redirect?http://www.nsf.gov" title="NSF"><img src="http://loci.cs.utk.edu/lbone/images/nsf.gif" width="140" height="75" alt="NSF" title="NSF\" border=0></a>
&nbsp;&nbsp;<a href="/redirect?http://www.internet2.edu/"><img src="http://dsi.internet2.edu/images/i2.gif" width="140" height="75" alt="I-2" border="0"></a></p>
</table></center>-->
</td>
</tr>
<tr>
<td class="cellcontent" width="10" height="25"><img src="http://loci.cs.utk.edu/themes/Alison/images/bottomleft_corner.gif" width="10" height="25"></td>
<td class="cellcontent" colspan="2" height="25">&nbsp;</td>
<td class="cellcontent" width="10" height="25"><img src="http://loci.cs.utk.edu/themes/Alison/images/bottomright_corner.gif" width="10" height="25"></td>
</tr></table><p>&nbsp;</p></div>

</body>

</html>

